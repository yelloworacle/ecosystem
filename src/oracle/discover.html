<!DOCTYPE html>

<div
    localstorage-get="user_id"
    localstorage-attribute="object"
    localstorage-selector="[array='users'][]"
    class="display:flex justify-content:center width:100% padding-top:80px">
    <style>
        /* Add a CSS animation to make the icon spin */
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        /* Apply the animation to the icon with a class */
        [src="./assets/svg/spinner.svg"] {
            animation: spin 2s linear infinite; /* Adjust the duration and other properties as needed */
        }
    </style>
    <div
        class="display:flex flex-direction:column gap:15px width:100% min-width:275px max-width:600px">
        <section class="position:relative">
            <div
                filter-sort-key="position"
                filter-sort-direction="asc"
                filter-parent="[array='questions']"></div>

            <textarea
                id="answeredQuestions"
                array="users"
                key="answeredQuestions"
                filter-key="name"
                filter-operator="$nin"
                filter-next
                value-type="json"
                realtime="false"
                input-attribute="read"
                input-value="true"
                input-next
                hidden></textarea>

            <div
                id="questions"
                array="questions"
                object
                filter-limit="1"
                render-selector="[template]"
                read="false"
                loader>
                <form
                    realtime="false"
                    array="users"
                    class="position:relative"
                    template>
                    <input
                        id="answeredQuestion"
                        type="hidden"
                        key="answeredQuestions[]"
                        value="{{object.name}}"
                        read="false" />

                    <label for="question" class="load-value margin-bottom:5px"
                        >{{object.question}}</label
                    >
                    <input
                        id="question"
                        type="{{object.type}}"
                        key="questions.{{object.name}}"
                        read="false"
                        onkeydown="if (event.key === 'Enter') this.nextElementSibling.click()" />
                    <a
                        actions="click, {{object.actions}}"
                        click-selector="i[src]"
                        click-attribute="src"
                        click-value="./assets/svg/spinner.svg"
                        class="position:absolute bottom:12px right:8px font-size:20px">
                        <i
                            class="display:flex"
                            src="./assets/svg/angle-right.svg"></i>
                    </a>

                    <div class="progress-bar">
                        <input
                            type="hidden"
                            calculate="({{object.position}} % 8 === 0 || {{object.position}} % 8 === 1 ) ? 0 : (({{object.position}} / 8) * 100)"
                            input-next
                            input-attribute="style"
                            value-prefix="width:"
                            value-suffix="%" />
                        <div class="progress" style="width: 0%"></div>
                    </div>
                </form>
            </div>
        </section>
        <!-- <textarea
            id="currentCareers"
            array="users"
            key="careers"
            filter-key="name"
            filter-operator="$in"
            filter-selector="document; #careers"
            value-type="json"
            realtime="false"
            input-attribute="read"
            input-value="true"
            input-next
            hidden></textarea> -->

        <div
            id="careers"
            array="users"
            object="{{}}"
            key="careers"
            render-selector="[template]"
            filter-limit="1"
            loader>
            <div class="card margin-bottom:15px" template>
                <div class="card-content">
                    <div class="card-row full-width">
                        <span class="card-label">Career Name:</span>
                        <span class="card-value load-value"
                            >{{careers.name}}</span
                        >
                    </div>
                    <div class="card-row">
                        <span class="card-label">Average Salary:</span>
                        <span class="card-value load-value"
                            >{{careers.salary}}</span
                        >
                    </div>
                    <div class="card-row">
                        <span class="card-label">Stress Level:</span>
                        <span class="card-value load-value"
                            >{{careers.stress}}</span
                        >
                    </div>

                    <div class="card-row">
                        <span class="card-label">Pros:</span>
                        <span class="card-value load-value"
                            >{{careers.pros}}</span
                        >
                    </div>
                    <div class="card-row">
                        <span class="card-label">Cons:</span>
                        <span class="card-value load-value"
                            >{{careers.cons}}</span
                        >
                    </div>
                    <div class="card-row full-width">
                        <span class="card-label">Interesting Fact:</span>
                        <span class="card-value load-value"
                            >{{careers.facts}}</span
                        >
                    </div>
                </div>
            </div>
        </div>
    </div>

    <form>
        <div
            array="ai"
            object
            filter-key="type"
            filter-value="system"
            openai="system"
            save="false"
            component></div>
        <div
            array="users"
            object
            key="questions"
            openai="user"
            save="false"
            component></div>
        <textarea
            id="response"
            array="users"
            key="careers"
            value-type="json"
            openai="response"
            crdt="false"
            realtime="false"
            hidden></textarea>
        <!-- <textarea
            id="response"
            array="careers"
            key="{}"
            value-type="json"
            openai="response"
            crdt="false"
            hidden></textarea> -->

        <a id="request" actions="openAi, save"></a>
        <!-- <a id="request" actions="openAi">test</a> -->
    </form>

    <button
        class="button-round position:fixed bottom:20px right:20px"
        actions="install"
        hidden>
        <i src="./assets/svg/plus.svg"></i>
    </button>
</div>
