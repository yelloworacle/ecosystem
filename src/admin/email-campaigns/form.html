<!DOCTYPE html>
<a href="./signin.html" session="false" hidden></a>

<section class="centered flex-direction:column">
	<form
		id="newsletter-form"
		state_id="newsletter-fields"
		array="newsletter-emails"
		object=""
		class="flex-form">
		<!-- Toolbar Component -->
		<div
			path="./"
			src="./components/form-toolbar.html"
			class="width:100%"></div>

		<!-- Subject Field -->
		<floating-label class="input-600">
			<input
				type="text"
				key="subject"
				placeholder="Email Subject"
				class="floating-label" />
		</floating-label>
		<!-- Schedule Field (Optional) -->
		<floating-label class="input-300">
			<input
				type="datetime-local"
				key="schedule"
				placeholder="Schedule Send Time"
				class="floating-label" />
		</floating-label>

		<!-- Recipients Field -->
		<floating-label class="input-600">
			<textarea
				key="recipients"
				placeholder="Recipients (comma-separated emails)"
				class="floating-label"></textarea>
		</floating-label>

		<!-- Content Field -->
		<floating-label class="input-600">
			<editor
				id="email-content"
				contenteditable="true"
				key="content"
				realtime="true"
				placeholder="Email Content"
				input-selector="document; .content"
				input-attribute="value"
				class="floating-label rich-text-editor"></editor>
		</floating-label>

		<!-- Attachments Field -->
		<floating-label class="input-600">
			<!-- File Input -->
			<input
				type="file"
				key="attachments"
				accept="image/*,application/pdf"
				multiple
				array="files"
				object="ObjectId()"
				render-selector=".attachments-preview"
				class="floating-label input-icon" />

			<!-- Plus Icon for Visual Cue -->
			<i src="./assets/svg/plus.svg" class="attachment-icon"></i>

			<!-- Template for Rendering Attachments -->
			<div class="attachments-preview">
				<a
					id="attachment-upload"
					type="file"
					array="files"
					object="ObjectId()"
					key="{}"
					accept="image/*,application/pdf"
					class="hidden"
					read="false"
					upsert="true"
					render-selector="[template]"
					skip-attribute>
					<div template file_id="{{object.id}}">
						<input
							file="pathname"
							value="/attachments{{object.pathname}}"
							onload-selector="document; #attachments"
							onload-attribute="value"
							onload-if="!$template"
							hidden />
						<input file="directory" value="/attachments" hidden />
						<input file="path" value="/attachments" hidden />
						<input file="public" value="true" hidden />
						<input file="host[]" value="*" hidden />
					</div>
				</a>
			</div>
		</floating-label>

		<!-- Hidden Metadata Fields -->
		<input
			key="_id"
			input-selector="document; #sendform"
			input-attribute="object"
			hidden />
		<input type="datetime" key="created_at" value="$now" hidden />

		<!-- Save Button -->
		<button
			actions="save, state"
			state_to="mainView"
			state-src="./admin/newsletter/datatable.html"
			class="button-round">
			<i src="./assets/svg/save.svg"></i>
		</button>

		<!-- Send Newsletter Button -->
		<button
			click-selector="i[src]"
			click-attribute="src"
			click-value="./assets/svg/spinner.svg"
			actions="click, save, timeout(1000), render(document; #publish), timeout(1000), action(document; #sethtml), timeout(1000), action(document; #savefile), action(document; #emailSent)">
			Send Newsletter
			<i id="emailSent-icon" src="./assets/svg/paper-plane.svg"></i>
		</button>

		<!-- Email Sent Indicator -->
		<a
			id="emailSent"
			click-selector="document; #sent-icon"
			click-attribute="src"
			click-value="./assets/svg/check-circle.svg"
			hidden></a>
	</form>

	<!-- Publish Form to Handle Email Sending -->
	<form id="sendform" array="files" object="" upsert="true" hidden>
		<input key="name" class="title" />
		<input key="pathname" value-prefix="/newsletter/" class="title" />
		<input key="path" value="/newsletter" />
		<input key="directory" value="newsletter" />
		<input key="content-type" value="text/html" />
		<input key="$addToSet.host" value="*" />
		<input key="public" value="true" />

		<div id="publish" render-next render="object"></div>
		<div
			id="sethtml"
			src="./newsletter/email.html"
			value-type="text"
			click-next
			click-attribute="value"></div>

		<textarea key="src"></textarea>
		<button id="savefile" actions="save" hidden>Send Email</button>
	</form>

	<!-- Optional: OpenAI Integration for Content Generation -->
	<form>
		<input
			openai="chat.completions.create"
			openai-key="model"
			value="gpt-4-1106-preview"
			hidden />

		<input
			openai="chat.completions.create"
			openai-key="messages[0].role"
			value="system"
			hidden />
		<textarea
			array="ai"
			object
			key="content"
			filter-key="name"
			filter-value="Newsletter Content"
			openai="chat.completions.create"
			openai-key="messages[0].content"
			hidden></textarea>

		<input
			openai="chat.completions.create"
			openai-key="messages[1].role"
			value="user"
			hidden />
		<input
			class="title"
			openai="chat.completions.create"
			openai-key="messages[1].content"
			hidden />

		<textarea
			id="input"
			openai="chat.completions.create"
			openai-key="choices[0].message.content"
			openai-request="false"
			marked
			input-selector="document; #email-content"
			input-attribute="value"
			hidden></textarea>
		<a
			id="generate-content"
			actions="openai.chat.completions.create, action(document; #generate-details)"></a>
	</form>

	<div src="./components/toolbar.html" value-type="outerHTML"></div>
</section>
