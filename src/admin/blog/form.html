<section class="centered flex-direction:column">
	<form
		id="blog-form"
		state_id="form-fields"
		state-overwrite
		array="blog-posts"
		object=""
		class="flex-form">
		<div
			path="./"
			src="./components/form-toolbar.html"
			class="width:100%"></div>

		<floating-label class="input-300">
			<input
				type="text"
				key="author"
				placeholder="Author Name"
				value="YellowOracle"
				class="floating-label" />
		</floating-label>
		<!-- <floating-label class="input-300" hidden>
			<input placeholder="Published On" readonly />
			<input
				type="datetime"
				key="published"
				value-type="toLocaleString"
				placeholder="Published On"
				input-query="$previous"
				input-attribute="value"
				hidden />
		</floating-label>
 -->
		<floating-label class="input-300">
			<input
				type="datetime-local"
				key="published"
				placeholder="Publish On" />
		</floating-label>

		<floating-label class="input-600">
			<input
				type="text"
				key="title"
				placeholder="Title"
				input-query="$next"
				input-attribute="value"
				class="floating-label input-icon" />

			<input
				type="hidden"
				value-replaceall=" "
				value-replacement="-"
				value-suffix=".html"
				input-query="$next"
				input-attribute="value" />

			<input
				type="hidden"
				value-replace="/[&:!#()*+,;=?@\[\]\\\u2013\u2014\u2019\u0022\u0027`<>|{}^%$]/g, ''"
				input-query="$document .title[]"
				input-attribute="value" />

			<a
				actions="action($document #generate-post)"
				click-query="i[src]"
				click-attribute="src"
				click-value="./assets/svg/spinner.svg"
				class="floating-icon">
				<i
					id="#clickIcon"
					src="./assets/svg/wand-magic-sparkles.svg"
					class="width:20px height:20px"></i>
			</a>
			<div
				id="generated-icon"
				click-query="$previous i"
				click-attribute="src"
				click-value="./assets/svg/check-circle.svg"></div>
		</floating-label>

		<input type="hidden" key="url" value-prefix="/blog/" class="title" />

		<floating-label class="input-300">
			<input
				id="imageurl"
				key="image"
				filter-query-key="pathname"
				filter-query="$next"
				placeholder="Image Url"
				class="floating-label input-icon" />
			<a
				actions="action($document #generate-image)"
				click-query="i[src]"
				click-attribute="src"
				click-value="./assets/svg/spinner.svg"
				class="floating-icon right:35px!important">
				<i
					src="./assets/svg/wand-magic-sparkles.svg"
					class="width:20px height:20px"></i>
			</a>
			<div
				id="imageGenerated"
				click-query="$previous i"
				click-attribute="src"
				click-value="./assets/svg/check-circle.svg"></div>

			<a
				id="imagefile"
				type="file"
				array="files"
				object="ObjectId()"
				key="{}"
				accept="image/*"
				class="floating-icon"
				read="false"
				upsert="true"
				render-query="[template]"
				skip-attribute>
				<div template file_id="{{object.id}}">
					<input
						file="pathname"
						value="/assets{{object.pathname}}"
						onload-query="$document #imageurl"
						onload-attribute="value"
						onload-if="!$template"
						hidden />
					<input file="directory" value="/assets" hidden />
					<input file="path" value="/assets" hidden />
					<input file="public" value="true" hidden />
					<input file="host[]" value="*" hidden />
				</div>

				<i src="./assets/svg/plus.svg"></i>
			</a>
		</floating-label>
		<floating-label class="input-300">
			<input
				id="videourl"
				key="video"
				filter-query-key="pathname"
				filter-query="$next"
				placeholder="Video Url"
				class="floating-label input-icon" />
			<a
				id="videofile"
				type="file"
				array="files"
				object="ObjectId()"
				key="{}"
				accept="video/*"
				class="floating-icon"
				read="false"
				upsert="true"
				render-query="[template]"
				skip-attribute>
				<div template file_id="{{object.id}}">
					<input
						file="pathname"
						value="/assets{{object.pathname}}"
						onload-query="$document #videourl"
						onload-attribute="value"
						onload-if="!$template"
						hidden />
					<input file="directory" value="/assets" hidden />
					<input file="path" value="/assets" hidden />
					<input file="public" value="true" hidden />
					<input file="host[]" value="*" hidden />
				</div>

				<i src="./assets/svg/plus.svg"></i>
			</a>
		</floating-label>

		<floating-label class="input-600">
			<textarea
				key="description"
				input-query="$document .description"
				input-attribute="value"
				placeholder="Description"
				class="floating-label"></textarea>
		</floating-label>

		<floating-label class="input-600">
			<editor
				id="content"
				contenteditable="true"
				key="content"
				realtime="true"
				placeholder="Content"
				input-query="$document .content"
				input-attribute="value"
				class="floating-label markdown-body"></editor>
		</floating-label>

		<floating-label class="input-600">
			<select
				key="category"
				class="floating-label"
				placeholder="Category">
				<option value="">Select Category</option>
				<option value="education">education</option>
			</select>
		</floating-label>

		<floating-label class="input-600">
			<input
				type="text"
				key="tags"
				placeholder="Tags (comma-separated)"
				class="floating-label" />
		</floating-label>

		<floating-label class="input-600">
			<input
				type="text"
				key="meta-title"
				placeholder="Meta Title"
				class="floating-label" />
		</floating-label>

		<floating-label class="input-600">
			<textarea
				key="meta-keywords"
				placeholder="Meta Keywords"
				class="floating-label"></textarea>
		</floating-label>

		<floating-label class="input-600">
			<textarea
				key="meta-description"
				placeholder="Meta Description"
				class="floating-label"></textarea>
		</floating-label>

		<input
			key="_id"
			input-query="$document #publishform"
			input-attribute="object"
			hidden />
		<!-- <input type="datetime" key="published" value="$now" hidden /> -->

		<div
			class="display:flex justify-content:flex-end flex-wrap:wrap gap:20px width:100%">
			<button
				actions="state"
				state_to="mainView"
				state-src="$back"
				class="red margin-left:auto flex-grow:1">
				<i src="../assets/svg/ban.svg"></i>
				<span class="margin-left:5px"> Cancel</span>
			</button>
			<button
				actions="click, save, click, timeout(2000), click"
				click-query="i"
				click-attribute="src"
				click-value="../assets/svg/spinner.svg, ../assets/svg/check-circle.svg, ../assets/svg/save.svg"
				class="flex-grow:1">
				<i src="../assets/svg/save.svg"></i>
				<span class="margin-left:5px">Save</span>
			</button>

			<button
				class="flex-grow:1 green"
				click-query="i[src]"
				click-attribute="src"
				click-value="./assets/svg/spinner.svg"
				actions="click, save, timeout(4000), render($document #publish), timeout(3000), action($document #savefile), action($document #postPublished)">
				<i id="published-icon" src="./assets/svg/paper-plane.svg"></i>
				<span class="margin-left:5px">Publish</span>
			</button>
		</div>
		<a
			id="postPublished"
			click-query="$document #published-icon"
			click-attribute="src"
			click-value="./assets/svg/check-circle.svg"
			hidden></a>
	</form>

	<!-- Get ObjectId from blobpost and reuse for file  -->
	<form id="publishform" array="files" object="" upsert="true" hidden>
		<input key="name" class="title" />
		<input key="pathname" value-prefix="/blog/" class="title" />
		<input key="path" value="/blog" />
		<input key="directory" value="blog" />
		<input key="content-type" value="text/html" />
		<input key="$addToSet.host" value="*" />
		<input key="public" value="true" />

		<div id="publish" render-query="[template]" render="object">
			<div template value-type="text" key="src" read="false"></div>
			<div
				src="./blog/post.html"
				value-type="text"
				input-query="$previous"
				input-attribute="value"
				hidden></div>
		</div>
		<button id="savefile" actions="save" hidden>Publish Post</button>
	</form>

	<form>
		<input
			openai="chat.completions.create"
			openai-key="model"
			value="gpt-4-1106-preview"
			hidden />

		<input
			openai="chat.completions.create"
			openai-key="messages[0].role"
			value="system"
			hidden />
		<textarea
			array="ai"
			object
			key="content"
			filter-query-key="name"
			filter-query-value="Blog Post"
			openai="chat.completions.create"
			openai-key="messages[0].content"
			hidden></textarea>

		<input
			openai="chat.completions.create"
			openai-key="messages[1].role"
			value="user"
			hidden />
		<input
			class="title"
			openai="chat.completions.create"
			openai-key="messages[1].content"
			hidden />

		<input
			openai="chat.completions.create"
			openai-key="messages[2].role"
			value="user"
			hidden />
		<input
			class="description"
			openai="chat.completions.create"
			openai-key="messages[2].content"
			hidden />

		<textarea
			id="input"
			openai="chat.completions.create"
			openai-key="choices[0].message.content"
			openai-request="false"
			marked
			input-query="$document #content"
			input-attribute="value"
			hidden></textarea>
		<a
			id="generate-post"
			actions="openai.chat.completions.create, action($document #generate-details), action($document #generate-image)"></a>
	</form>

	<form>
		<input
			openai="chat.completions.create"
			openai-key="model"
			value="gpt-4-1106-preview"
			hidden />

		<input
			openai="chat.completions.create"
			openai-key="messages[0].role"
			value="system"
			hidden />
		<textarea
			array="ai"
			object
			key="content"
			filter-query-key="name"
			filter-query-value="Blog Details"
			openai="chat.completions.create"
			openai-key="messages[0].content"
			hidden></textarea>

		<input
			openai="chat.completions.create"
			openai-key="messages[1].role"
			value="user"
			hidden />
		<input
			class="title"
			openai="chat.completions.create"
			openai-key="messages[1].content"
			hidden />

		<input
			openai="chat.completions.create"
			openai-key="messages[2].role"
			value="user"
			hidden />
		<input
			class="content"
			openai="chat.completions.create"
			openai-key="messages[2].content"
			hidden />

		<textarea
			id="input"
			openai="chat.completions.create"
			openai-key="choices[0].message.content"
			openai-request="false"
			input-query="$document #blog-form"
			input-attribute="value"
			value-type="json"
			value-replace="/```json\n|\n```/g"
			hidden></textarea>

		<a
			id="generate-details"
			actions="openai.chat.completions.create, action($document #generated-icon)"></a>
	</form>

	<form api="openai">
		<input
			openai="images.generate"
			openai-key="model"
			value="dall-e-3"
			hidden />

		<textarea
			class="title"
			openai="images.generate"
			openai-key="prompt"
			value-prefix="generate an image for a blogpost related to the following topic: "
			hidden></textarea>
		<input
			type="number"
			openai="images.generate"
			openai-key="n"
			value="1"
			hidden />
		<input
			openai="images.generate"
			openai-key="size"
			value="1024x1024"
			hidden />

		<!-- <img src="" class="max-width:100% height:auto" /> -->
		<input
			openai="images.generate"
			openai-key="data[0].url"
			openai-request="false"
			import-url-query="$document #imagefile"
			import-url
			hidden />

		<a
			id="generate-image"
			actions="openai.images.generate, importUrl, action($document #imageGenerated)"></a>
	</form>

	<div src="./components/toolbar.html" value-type="outerHTML"></div>
</section>
