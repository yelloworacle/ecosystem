<!DOCTYPE html>
<a href="./signin.html" session="false" hidden></a>

<div class="width:100% max-width:600px">
    <div class="padding:10px">
        <form realtime="false">
            <input
                id="subscriptionId"
                type="hidden"
                array="users"
                object=""
                key="subscriptionId"
                stripe="subscription.update"
                stripe-key="$param[0].subscriptionId"
                required />
            <input
                type="hidden"
                array="users"
                object=""
                key="members"
                stripe="subscription.update"
                stripe-key="items[0].price"
                value="price_1OgphfDSpIU4j2Jos30M9l41" />

            <!-- +1 from members -->
            <input
                type="number"
                array="users"
                object=""
                key="members"
                stripe="subscription.update"
                stripe-key="items[0].quantity"
                required
                hidden />

            <input
                type="email"
                array="users"
                object=""
                key="email"
                required
                hidden />

            <input
                type="hidden"
                array="users"
                object=""
                key="_id"
                postmark="memberAccount" />

            <div class="position:relative margin-top:5px">
                <input
                    type="email"
                    placeholder="Member Email"
                    required
                    class="question" />
                <a
                    actions="validate, stripe.subscriptions.update, postmark.sendEmail"
                    click-selector="i[src]"
                    click-attribute="src"
                    click-value="./assets/svg/spinner.svg"
                    class="sibling display:flex position:absolute top:9px right:8px font-size:20px color:green:hover fill:green:hover">
                    <span class="margin-right:5px font-weight:400">Add </span>
                    <i src="./assets/svg/angle-right.svg"></i>
                </a>
            </div>
        </form>
    </div>

    <div
        class="display:flex justify-content:space-between align-items:center font-size:20px width:100%">
        <a
            actions="state"
            state_to="mainView"
            state-src="./admin/users/datatable.html"
            state-overwrite
            class="padding:0px_10px"
            ><i src="./assets/svg/angle-left.svg"></i
        ></a>
        <div
            class="display:flex align-items:center transition:0.3s"
            hover-selector=".options"
            hover-attribute="class"
            hover-value="display:block!important">
            <div class="display:none options">
                <div
                    actions="delete"
                    delete-selector="document; tbody[array]"
                    class="padding:0px_10px">
                    <i src="./assets/svg/trash-alt.svg"></i>
                </div>
            </div>
            <div class="padding:0px_10px">
                <i
                    class="width:8px display:block"
                    src="./assets/svg/ellipsis-v.svg"></i>
            </div>
        </div>
    </div>

    <table class="width:100% border-collapse:collapse">
        <tbody>
            <tr class="border-bottom:1px_solid_darkgray">
                <td class="position:sticky top:0 background:white padding:10px">
                    <floating-label>
                        <input
                            type="text"
                            filter-selector="document; tbody[render-selector]"
                            filter-key="firstname"
                            state_id="datatable"
                            placeholder="Name"
                            class="floating-label" />
                    </floating-label>
                    <span
                        class="position:absolute bottom:20px right:20px float:right z-index:6">
                        <a
                            filter-selector="document; tbody[render-selector]"
                            filter-sort-key="firstname"
                            filter-sort-direction="asc"
                            click-value="desc, asc"
                            click-attribute="filter-sort-direction"
                            state_id="datatable">
                            <i
                                toggle-attribute="src"
                                toggle-value="../assets/svg/sort-down.svg, ../assets/svg/sort-up.svg"
                                src="../assets/svg/sort.svg"></i>
                        </a>
                    </span>
                </td>
            </tr>
        </tbody>

        <tbody
            array="users"
            object
            filter-sort-key="name"
            filter-sort-direction="asc"
            render-selector="[template]">
            <tr
                class="background:gainsboro:hover border-bottom:1px_solid_darkgray"
                template
                object="{{object._id}}"
                toggle="selected"
                toggle-attribute="class">
                <td
                    class="padding:5px display:flex min-width:200px align-items:center justify-content:space-between">
                    <div>
                        <a
                            actions="state"
                            state_to="mainView"
                            state-src="./admin/users/form.html"
                            state-overwrite>
                            <h4>{{object.firstname}} {{object.lastname}}</h4>
                            <div
                                state_to="form-fields"
                                state-object="{{object._id}}"></div>
                        </a>
                        <h5>{{object.email}}</h5>
                    </div>
                    <div class="padding:10px">
                        <form realtime="false">
                            <input
                                id="subscriptionId"
                                type="hidden"
                                array="users"
                                object=""
                                key="subscriptionId"
                                stripe="subscription.update"
                                stripe-key="$param[0].subscriptionId"
                                required />
                            <input
                                type="hidden"
                                stripe="subscription.update"
                                stripe-key="items[0].price"
                                value="price_1OgphfDSpIU4j2Jos30M9l41" />

                            <!-- deduct -1 from members -->
                            <input
                                type="number"
                                array="users"
                                object=""
                                key="members"
                                stripe="subscription.update"
                                stripe-key="items[0].quantity"
                                required
                                hidden />

                            <a
                                actions="validate, stripe.subscriptions.update"
                                class="color:#ff4d4d:hover">
                                <i src="./assets/svg/trash-alt.svg"></i>
                            </a>
                        </form>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- <div filter-on="scroll" filter-previous="[render-selector]"></div> -->

    <button
        actions="state"
        state_to="mainView"
        state-src="./account/members/form.html"
        state-overwrite
        class="button-round">
        <i src="./assets/svg/plus.svg"></i>
        <div state_to="form-fields" state-object="" state-overwrite></div>
    </button>
</div>
