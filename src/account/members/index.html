<!DOCTYPE html>
<a href="./signin.html" session="false" hidden></a>

<div class="width:100% max-width:600px" module="stripe">
    <form
        realtime="false"
        array="users"
        object="$user_id"
        class="margin-bottom:20px width:300px width:100%@xs@sm margin-left:auto">
        <input type="hidden" key="name" />
        <input
            id="subscriptionItemId"
            type="hidden"
            key="subscriptionItemId"
            stripe="subscriptionItems.update"
            stripe-key="$param[0]"
            required />

        <input id="members" type="number" key="members.$length" hidden />

        <input
            type="number"
            stripe="subscriptionItems.update"
            stripe-key="quantity"
            calculate="{(#members)} + 1"
            required
            hidden />

        <input type="hidden" key="name" />
        <input type="hidden" key="from" value="invite@yelloworacle.com" />
        <input type="hidden" key="origin" value="$origin" />
        <input type="hidden" key="hostname" value="yelloworacle.com" />
        <input type="hidden" key="path" value="/invite.html" />

        <div class="position:relative margin-top:5px">
            <input
                type="email"
                placeholder="Member Email"
                key="email"
                crud="false"
                input-selector="document; #setemailinput"
                input-attribute="value"
                required />
            <a
                actions="validate, stripe.subscriptionItems.update, inviteUser, action(document; #setmember)"
                class="sibling display:flex position:absolute top:9px right:8px font-size:20px color:green:hover fill:green:hover">
                <span class="margin-right:5px font-weight:400">Add </span>
                <i src="./assets/svg/angle-right.svg"></i>
            </a>
        </div>
    </form>

    <form object="$user_id">
        <input
            id="setemailinput"
            type="hidden"
            array="users"
            key="$addToSet.members"
            realtime="false" />
        <a id="setmember" actions="save"></a>
    </form>

    <div
        class="display:flex justify-content:space-between align-items:center font-size:20px width:100%">
        <a
            actions="state"
            state_to="mainView"
            state-src="./account/profile/"
            state-overwrite
            class="padding:0px_10px"
            ><i src="./assets/svg/angle-left.svg"></i
        ></a>
        <div
            class="display:flex align-items:center transition:0.3s"
            hover-selector=".options"
            hover-attribute="class"
            hover-value="display:block!important">
            <div class="display:none options">
                <div
                    actions="delete"
                    delete-selector="document; tbody[array]"
                    class="padding:0px_10px">
                    <i src="./assets/svg/trash-alt.svg"></i>
                </div>
            </div>
            <div class="padding:0px_10px">
                <i
                    class="width:8px display:block"
                    src="./assets/svg/ellipsis-v.svg"></i>
            </div>
        </div>
    </div>

    <table class="width:100% border-collapse:collapse">
        <tbody>
            <tr class="border-bottom:1px_solid_darkgray">
                <td class="position:sticky top:0 background:white padding:10px">
                    <floating-label>
                        <input
                            type="text"
                            filter-selector="document; tbody[render-selector]"
                            filter-key="firstname"
                            state_id="datatable"
                            placeholder="Name" />
                    </floating-label>
                    <span
                        class="position:absolute bottom:20px right:20px float:right z-index:6">
                        <a
                            filter-selector="document; tbody[render-selector]"
                            filter-sort-key="firstname"
                            filter-sort-direction="asc"
                            click-value="desc, asc"
                            click-attribute="filter-sort-direction"
                            state_id="datatable">
                            <i
                                toggle-attribute="src"
                                toggle-value="../assets/svg/sort-down.svg, ../assets/svg/sort-up.svg"
                                src="../assets/svg/sort.svg"></i>
                        </a>
                    </span>
                </td>
            </tr>
        </tbody>
        <tbody
            array="users"
            object="$user_id"
            key="members"
            render-selector="[template]">
            <tr
                class="background:gainsboro:hover border-bottom:1px_solid_darkgray"
                template
                object="{{object._id}}"
                toggle="selected"
                toggle-attribute="class">
                <td
                    class="padding:5px display:flex min-width:200px align-items:center justify-content:space-between">
                    <div>
                        <h4>
                            <span
                                array="users"
                                object="{{members}}"
                                key="firstname"></span>
                            <span
                                array="users"
                                object="{{members}}"
                                key="lastname"></span>
                        </h4>
                        <h5 array="users" object="{{members}}" key="email">
                            {{members}}
                        </h5>
                    </div>

                    <div class="padding:10px">
                        <form realtime="false">
                            <input
                                type="hidden"
                                array="users"
                                object="$user_id"
                                key="subscriptionItemId"
                                stripe="subscriptionItems.update"
                                stripe-key="$param[0]"
                                required />

                            <input
                                type="number"
                                stripe="subscriptionItems.update"
                                stripe-key="quantity"
                                calculate="{(#members)} - 1"
                                required
                                hidden />

                            <input
                                array="users"
                                object="$user_id"
                                value="{{members}}"
                                key="$pull.members"
                                hidden />

                            <a
                                actions="validate, stripe.subscriptionItems.update, save"
                                class="color:#ff4d4d:hover">
                                <i src="./assets/svg/trash-alt.svg"></i>
                            </a>
                        </form>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- <div filter-on="scroll" filter-previous="[render-selector]"></div> -->

    <div class="position:fixed!important bottom:15px right:15px z-index:2">
        <div
            template="validate, inviteUser"
            class="card position:fixed!important bottom:15px right:15px padding:10px {{status}}">
            <span class="{{type}}">{{message}}</span><a actions="remove"> X</a>
        </div>
    </div>

    <button
        actions="state"
        state_to="mainView"
        state-src="./account/members/form.html"
        state-overwrite
        class="button-round">
        <i src="./assets/svg/plus.svg"></i>
        <div state_to="form-fields" state-object="" state-overwrite></div>
    </button>
</div>
