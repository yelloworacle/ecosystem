<!DOCTYPE html>
<div class="main-view max-width:800px">
    <a href="./signin.html" session="false" hidden></a>

    <style>
        .ambassador {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        #terms {
            display: none;
        }

        [terms="false"] #table {
            display: none;
        }

        [terms="false"] #dashboard {
            display: none;
        }

        [terms="false"] #terms {
            display: block;
        }

        .ambassador h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        .ambassador p {
            font-size: 18px;
            font-weight: 400;
            margin-top: 20px;
            line-height: 1.6;
        }
        .ambassador a {
            padding-left: 15px;
            color: #1a73e8;
            font-weight: bold;
        }
        .ambassador .join {
            text-align: center;
            padding-top: 30px;
        }
        .ambassador .join .terms {
            text-align: center;
            padding: 30px;
        }
        #dashboard .card {
            flex-grow: 1;
        }
    </style>

    <input
        type="hidden"
        realtime="false"
        filter-key="ambassador"
        filter-selector="document; [ambassador][]"
        value="$user_id" />

    <section id="dashboard" class="width:100% padding:0px">
        <div
            class="width:100% display:flex justify-content:flex-end margin-bottom:30px">
            <button
                actions="state"
                state_to="mainView"
                state-src="./account/ambassador/form/"
                state-overwrite=""
                class="float:right">
                <i src="./assets/svg/cog.svg"></i> Payout Settings
            </button>
        </div>

        <div class="display:flex flex-wrap:wrap gap:15px margin-bottom:30px">
            <div id="subscribers" class="card">
                <h2>Subscribers</h2>

                <span array="users" object key="$length" ambassador>0</span>
            </div>

            <!-- Next Payout Section -->
            <div id="nextPayout" class="card">
                <h2>Next Payout</h2>
                <span>$</span>
                <span
                    array="payouts"
                    object
                    filter-key="status"
                    filter-value="pending"
                    key="$sum.amount"
                    ambassador
                    >0</span
                >
            </div>

            <!-- Total Payouts Section -->
            <div id="totalPayouts" class="card">
                <h2>Total Payouts</h2>
                <span>$</span>
                <span
                    array="payouts"
                    object
                    filter-key="status"
                    filter-value="paid"
                    key="$sum.amount"
                    ambassador
                    >0</span
                >
            </div>
        </div>
    </section>
    <section id="table" class="width:100% padding:0px">
        <table class="width:100% border-collapse:collapse">
            <tbody>
                <tr class="border-bottom:1px_solid_darkgray">
                    <td
                        class="position:sticky top:0 background:white padding:10px">
                        <floating-label>
                            <input
                                type="text"
                                filter-selector="document; tbody[render-selector]"
                                filter-key="amount"
                                state_id="datatable"
                                placeholder="Amount"
                                class="floating-label" />
                        </floating-label>
                        <span
                            class="position:absolute bottom:20px right:20px float:right z-index:6">
                            <a
                                filter-selector="document; tbody[render-selector]"
                                filter-sort-key="amount"
                                filter-sort-direction="asc"
                                click-value="desc, asc"
                                click-attribute="filter-sort-direction"
                                state_id="datatable">
                                <i
                                    toggle-attribute="src"
                                    toggle-value="./assets/svg/sort-down.svg, ./assets/svg/sort-up.svg"
                                    src="./assets/svg/sort.svg"></i>
                            </a>
                        </span>
                    </td>
                    <td
                        class="position:sticky top:0 background:white padding:10px">
                        <floating-label>
                            <input
                                type="text"
                                filter-selector="document; tbody[render-selector]"
                                filter-key="status"
                                state_id="datatable"
                                placeholder="status"
                                class="floating-label" />
                        </floating-label>
                        <span
                            class="position:absolute bottom:20px right:20px float:right z-index:6">
                            <a
                                filter-selector="document; tbody[render-selector]"
                                filter-sort-key="status"
                                filter-sort-direction="asc"
                                click-value="desc, asc"
                                click-attribute="filter-sort-direction"
                                state_id="datatable">
                                <i
                                    toggle-attribute="src"
                                    toggle-value="./assets/svg/sort-down.svg, ./assets/svg/sort-up.svg"
                                    src="./assets/svg/sort.svg"></i>
                            </a>
                        </span>
                    </td>
                    <td
                        class="position:sticky top:0 background:white padding:10px">
                        <floating-label>
                            <input
                                type="text"
                                filter-selector="document; tbody[render-selector]"
                                filter-key="_id"
                                state_id="datatable"
                                placeholder="id"
                                class="floating-label" />
                        </floating-label>
                        <span
                            class="position:absolute bottom:20px right:20px float:right z-index:6">
                            <a
                                filter-selector="document; tbody[render-selector]"
                                filter-sort-key="_id"
                                filter-sort-direction=""
                                click-value="desc, asc"
                                click-attribute="filter-sort-direction"
                                state_id="datatable">
                                <i
                                    toggle-attribute="src"
                                    toggle-value="./assets/svg/sort-down.svg, ./assets/svg/sort-up.svg"
                                    src="./assets/svg/sort.svg"></i>
                            </a>
                        </span>
                    </td>
                </tr>
            </tbody>

            <tbody
                array="payouts"
                object
                render-selector="[template]"
                ambassador>
                <tr
                    class="background:gainsboro:hover border-bottom:1px_solid_darkgray"
                    template
                    object="{{object._id}}"
                    toggle="selected"
                    toggle-attribute="class">
                    <td
                        class="padding:10px display:flex min-width:200px align-items:center">
                        <a
                            actions="state"
                            state_to="adminView"
                            state-src="./users/form.html"
                            state-overwrite>
                            <h4>{{object.amount}}</h4>
                            <div
                                state_to="form-fields"
                                state-object="{{object._id}}"></div>
                        </a>
                    </td>
                    <td class="padding:10px">
                        <a
                            actions="state"
                            state_to="adminView"
                            state-src="./users/form.html"
                            state-overwrite>
                            <b>{{object.status}}</b>
                            <div
                                state_to="form-fields"
                                state-object="{{object._id}}"></div>
                        </a>
                    </td>
                    <td class="padding:10px">
                        <a
                            actions="state"
                            state_to="adminView"
                            state-src="./users/form.html"
                            state-overwrite>
                            <b>{{object._id}}</b>
                            <div
                                state_to="form-fields"
                                state-object="{{object._id}}"></div>
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- <div filter-on="fetched" filter-previous="[render-selector]"></div> -->
        <!-- <div filter-on="scroll" filter-previous="[render-selector]"></div> -->
    </section>

    <section
        id="terms"
        class="ambassador padding:40px@md@lg@xl"
        module="stripe">
        <input
            type="hidden"
            array="users"
            object="$user_id"
            key="ambassadorTerms"
            input-closest=".main-view"
            input-attribute="terms" />

        <h1>Become an Ambassador</h1>
        <p>
            Ambassadors of YellowOracle.com receive a unique ID and receive 15%
            of fees associated with purchases of services from users paid out
            with a minimum amount of $100 UDS, paid monthly, for the life of the
            relationship. Must have authority to act on behalf of any
            organization.
        </p>
        <p>
            Ambassadors of YellowOracle.com promote the website to both
            end-users and employers with their unique ID.
        </p>
        <p>
            YellowOracle appreciates Ambassadors who spread the word with
            integrity. Comments and suggestions are greatly appreciated to
            continuously improve user and employer experiences.
        </p>
        <p>
            Example: yelloworacle.com/customName or yelloworacle.com/unique-name
            <!-- <small class="width:100%">Example: yelloworacle.com/customName or yelloworacle.com/unique-name</small> -->
        </p>

        <form array="users" object="$user_id" class="join" realtime="false">
            <input
                type="text"
                key="ambassadorUrl"
                placeholder="Ambassador URL"
                required
                unique
                class="padding-left:145px!important" />
            <span
                class="position:relative top:-34px left:6px float:left padding:5px background:whitesmoke"
                >yelloworacle.com/</span
            >

            <input
                type="hidden"
                stripe="accounts.create"
                stripe-key="id"
                stripe-request="false"
                array="users"
                object="$user_id"
                key="ambassadorAccount" />

            <input
                type="hidden"
                stripe="accounts.create"
                stripe-key="type"
                value="custom" />
            <input
                type="hidden"
                key="email"
                stripe="accounts.create"
                stripe-key="email" />

            <input
                type="hidden"
                stripe="accounts.create"
                stripe-key="business_profile.product_description"
                value="AI generated career recomendations" />
            <input
                type="number"
                stripe="accounts.create"
                stripe-key="business_profile.mcc"
                value="5968"
                hidden />
            <input
                type="hidden"
                stripe="accounts.create"
                stripe-key="business_profile.url"
                value="https://yelloworacle.com" />
            <input
                type="hidden"
                stripe="accounts.create"
                stripe-key="settings.payments.statement_descriptor"
                value="yelloworacle" />
            <input
                type="hidden"
                stripe="accounts.create"
                stripe-key="settings.payouts.schedule.interval"
                value="weekly" />
            <input
                type="hidden"
                stripe="accounts.create"
                stripe-key="settings.payouts.schedule.weekly_anchor"
                value="monday" />
            <input
                type="checkbox"
                stripe="accounts.create"
                stripe-key="capabilities.card_payments.requested"
                hidden
                checked />
            <input
                type="checkbox"
                stripe="accounts.create"
                stripe-key="capabilities.transfers.requested"
                hidden
                checked />

            <div
                class="width:100% display:flex flex-wrap:wrap margin-top:20px gap:15px">
                <floating-label class="flex-grow:1">
                    <input
                        type="text"
                        key="firstname"
                        stripe="accounts.create"
                        stripe-key="individual.first_name"
                        placeholder="First Name"
                        required />
                </floating-label>

                <floating-label class="flex-grow:1">
                    <input
                        type="text"
                        key="lastname"
                        stripe="accounts.create"
                        stripe-key="individual.last_name"
                        placeholder="Last Name"
                        required />
                </floating-label>
            </div>

            <div
                class="width:100% display:flex flex-wrap:wrap margin-top:20px gap:15px">
                <floating-label class="flex-grow:1">
                    <select
                        key="business_type"
                        stripe="accounts.create"
                        stripe-key="business_type"
                        placeholder="Bussiness Type">
                        <option value="individual">Individual</option>
                        <option value="company">Company</option>
                        <option value="non_profit">non_profit</option>
                        <option value="BR">government_entity</option>
                    </select>
                </floating-label>

                <floating-label class="flex-grow:1">
                    <select
                        id="country"
                        key="country"
                        stripe="accounts.create"
                        stripe-key="country"
                        placeholder="Country"
                        required
                        src="./account/ambassador/form/countries.html"></select>
                </floating-label>
            </div>

            <div class="terms">
                <input
                    type="checkbox"
                    key="ambassadorTerms"
                    placeholder="Accept Terms"
                    required />
                <a href="./terms/ambassador.html">Ambassador Terms</a>
            </div>

            <input
                type="hidden"
                stripe="accounts.create"
                stripe-key="tos_acceptance.ip"
                value="$ip" />

            <input
                type="date"
                stripe="accounts.create"
                stripe-key="tos_acceptance.date"
                value-type="toUnixTimestamp"
                value="$now"
                hidden />

            <div
                template="validate"
                class="card margin-bottom:15px padding:10px min-height:40px max-width:800px">
                <span class="{{status}}">
                    <span class="{{type}}">{{message}}</span
                    ><a actions="remove"> X</a>
                </span>
            </div>

            <!-- <button actions="stripe.accounts.create">Join</button> -->
            <button actions="validate, stripe.accounts.create, save">
                Join
            </button>
        </form>
    </section>
</div>

<script>
    (function () {
        let input = document.querySelector('[value="$ip"]');
        if (input) {
            fetch("https://api.ipify.org?format=json")
                .then((response) => response.json())
                .then((data) => {
                    input.value = data.ip;
                });
        }
    })();
</script>
